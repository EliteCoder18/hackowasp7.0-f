<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ProofNest</title>
  <script src="https://cdn.jsdelivr.net/npm/react@17/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;

    const App = () => {
      const [activeTab, setActiveTab] = useState('register');

      return (
        <div className="container mx-auto p-4">
          <h1 className="text-3xl font-bold mb-4">ProofNest</h1>
          <div className="tabs mb-4">
            <button
              className={`px-4 py-2 ${activeTab === 'register' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
              onClick={() => setActiveTab('register')}
            >
              Register
            </button>
            <button
              className={`px-4 py-2 ${activeTab === 'verify' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
              onClick={() => setActiveTab('verify')}
            >
              Verify
            </button>
          </div>
          {activeTab === 'register' ? <Register /> : <Verify />}
        </div>
      );
    };

    const Register = () => {
      const [username, setUsername] = useState('');
      const [text, setText] = useState('');
      const [file, setFile] = useState(null);
      const [message, setMessage] = useState('');

      const computeHash = async (data) => {
        const encoder = new TextEncoder();
        const dataBuffer = encoder.encode(data);
        const hashBuffer = await crypto.subtle.digest('SHA-256', dataBuffer);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        return hashHex;
      };

      const handleRegister = async () => {
        let data;
        if (file) {
          const reader = new FileReader();
          reader.onload = async (event) => {
            data = event.target.result;
            const hash = await computeHash(data);
            sendRegisterRequest(hash);
          };
          reader.readAsText(file);
        } else {
          data = text;
          const hash = await computeHash(data);
          sendRegisterRequest(hash);
        }
      };

      const sendRegisterRequest = async (hash) => {
        try {
          // Create a FormData object
          const formData = new FormData();
          
          // If you have a file, add it
          if (file) {
            formData.append('file', file);
          } else {
            // If you only have text, create a text file blob
            const textBlob = new Blob([text], { type: 'text/plain' });
            formData.append('file', textBlob, 'content.txt');
          }
          
          // Send the FormData (which includes the file)
          const response = await axios.post('http://localhost:8080/register', formData, {
            headers: {
              'Content-Type': 'multipart/form-data'
            }
          });
          
          setMessage(`Hash registered successfully: ${response.data.hash}`);
        } catch (error) {
          setMessage('Error: ' + (error.response?.data?.error || 'Unknown error'));
          console.error(error);
        }
      };

      return (
        <div className="bg-white p-6 rounded shadow">
          <h2 className="text-2xl mb-4">Register Hash</h2>
          <input
            type="text"
            placeholder="Username"
            value={username}
            onChange={(e) => setUsername(e.target.value)}
            className="border p-2 mb-4 w-full"
          />
          <textarea
            placeholder="Text"
            value={text}
            onChange={(e) => setText(e.target.value)}
            className="border p-2 mb-4 w-full"
          ></textarea>
          <input
            type="file"
            onChange={(e) => setFile(e.target.files[0])}
            className="mb-4"
          />
          <button
            onClick={handleRegister}
            className="bg-blue-500 text-white px-4 py-2 rounded"
          >
            Register
          </button>
          <p className="mt-4">{message}</p>
        </div>
      );
    };

    const Verify = () => {
      const [hash, setHash] = useState('');
      const [result, setResult] = useState(null);

      const handleVerify = async () => {
        try {
          const response = await axios.post('http://localhost:8080/verify', { hash });
          setResult(response.data);
        } catch (error) {
          setResult({ error: error.response?.data?.error || 'Unknown error' });
        }
      };

      return (
        <div className="bg-white p-6 rounded shadow">
          <h2 className="text-2xl mb-4">Verify Hash</h2>
          <input
            type="text"
            placeholder="Hash"
            value={hash}
            onChange={(e) => setHash(e.target.value)}
            className="border p-2 mb-4 w-full"
          />
          <button
            onClick={handleVerify}
            className="bg-blue-500 text-white px-4 py-2 rounded"
          >
            Verify
          </button>
          {result && (
            <div className="mt-4">
              {result.error ? (
                <p>Error: {result.error}</p>
              ) : (
                <div>
                  <p>User: {result.user}</p>
                  <p>Timestamp: {result.timestamp}</p>
                </div>
              )}
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
